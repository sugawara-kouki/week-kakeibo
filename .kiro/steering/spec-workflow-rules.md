---
inclusion: manual
---

# Specワークフロールール

このドキュメントは、Kiroでspecを作成する際の厳格なワークフローを定義します。このルールは**絶対厳守**してください。

## ワークフローの流れ

Specの作成は以下の順序で進めます。各フェーズを完了し、ユーザーの承認を得てから次のフェーズに進んでください。

### フェーズ1: 要件定義 (requirements.md)

**目的**: システムの「何を作るか」を明確にする

**成果物**: `.kiro/specs/{feature_name}/requirements.md`

**内容**:
- システム概要
- 用語集
- ユーザーストーリーと受入基準（EARS形式）

**完了条件**: ユーザーが要件定義を承認

---

### フェーズ2: 基本設計 (basic-design.md)

**目的**: システムの「何を作るか」と「どう動くか」の概要を定義（顧客視点）

**成果物**: `.kiro/specs/{feature_name}/basic-design.md`

**内容**:
- システム概要
- システム構成図
- 機能一覧と機能詳細
- 画面設計（画面遷移図、画面レイアウト）
- データ構造（エンティティ関連図）
- 外部インターフェース
- 非機能要件
- ユースケース一覧

**重要**: 
- **criteria.mdに沿って作成する**
- 顧客が理解できる表現を使用
- 専門用語は用語集で定義
- 図やモックアップを活用

**完了条件**: ユーザーが基本設計を承認

---

### フェーズ3: 詳細設計 (detailed-design.md)

**目的**: システムの「どうやって作るか」の具体的な実装方法を定義（開発者視点）

**成果物**: `.kiro/specs/{feature_name}/detailed-design.md`

**内容**:
- アーキテクチャ詳細（FSDレイヤー構造、依存関係）
- コンポーネント詳細設計
- データベース設計
- API設計
- フロントエンド設計
- セキュリティ設計
- パフォーマンス最適化
- テスト設計

**重要**: 
- **criteria.mdに沿って作成する**
- **コードは記載しない**（処理の流れを言葉で説明）
- プログラマーが実装できるレベルの詳細度
- 入出力、処理ロジック、エラーハンドリングを明記
- 設計判断の理由を記載

**完了条件**: ユーザーが詳細設計を承認

---

### フェーズ4: 設計サマリー (design.md)

**目的**: 基本設計と詳細設計の要点をまとめたサマリーを作成

**成果物**: `.kiro/specs/{feature_name}/design.md`

**内容**:
- 概要
- アーキテクチャ（FSDレイヤー構成）
- コンポーネント設計
- API設計
- データモデル
- ページ設計
- エラーハンドリング
- パフォーマンス最適化
- アクセシビリティ
- レスポンシブデザイン
- テスト戦略
- セキュリティ

**重要**: 
- basic-design.mdとdetailed-design.mdの内容を統合
- 実装時に参照しやすい形式
- 重要なポイントを簡潔にまとめる

**完了条件**: ユーザーが設計サマリーを承認

---

### フェーズ5: 設計レビュー

**目的**: criteria.mdに沿って基本設計と詳細設計の品質を確認

**レビュー項目**:

#### 基本設計書のレビュー
- [ ] 可読性: 顧客が理解できる表現か？専門用語は定義されているか？
- [ ] 網羅性: 画面/帳票の一覧と操作手順が明確か？
- [ ] 一貫性: あいまいな表現がないか？機能とビジネス要件の紐付けが明確か？

#### 詳細設計書のレビュー
- [ ] 実装可能性: プログラマーが迷わずコーディングできるレベルか？
- [ ] 統一性: 記述ルールが統一されているか？構造が可視化されているか？
- [ ] トレース: 基本設計書の機能IDとの対応付けがされているか？
- [ ] 堅牢性: エラー処理の具体的な実装が記述されているか？
- [ ] コードの記載: **コードが記載されていないか？**（言葉で説明されているか？）

**完了条件**: すべてのレビュー項目をクリア

---

### フェーズ6: タスクリスト作成 (tasks.md)

**目的**: 実装タスクを具体的なステップに分解

**成果物**: `.kiro/specs/{feature_name}/tasks.md`

**内容**:
- 実装タスクの一覧（チェックボックス形式）
- 各タスクの詳細説明
- 要件との紐付け
- オプションタスクの明示（*付き）

**タスクの粒度**:
- 1タスク = 1つの具体的な実装作業
- サブタスクは最大2階層まで
- 各タスクは要件を参照

**完了条件**: ユーザーがタスクリストを承認

---

## 重要なルール

### 1. 順序の厳守

**絶対に以下の順序を守ってください**:

```
requirements.md → basic-design.md → detailed-design.md → design.md → レビュー → tasks.md
```

- フェーズをスキップしない
- 前のフェーズの承認を得てから次に進む
- 各フェーズで必ずユーザーの承認を得る

### 2. criteria.mdの遵守

- basic-design.mdとdetailed-design.mdは**必ずcriteria.mdに沿って作成**
- レビュー時にcriteria.mdのチェックリストを使用
- criteria.mdに違反する内容は修正

### 3. 詳細設計書のコード記載禁止

**詳細設計書にはコードを記載しない**:

❌ **悪い例（コードを記載）**:
```typescript
export function mapTransactionsToDomain(transactions: unknown[]): Transaction[] {
  return transactions.map(transaction => TransactionSchema.parse(transaction));
}
```

✅ **良い例（言葉で説明）**:
- 関数名: `mapTransactionsToDomain`
- 処理内容: 配列の各要素に対してループ処理を実行し、TransactionSchemaでパース（バリデーション + 型変換）を行う
- パース成功時: 型安全なTransactionオブジェクトを配列に追加
- パース失敗時: ZodErrorをスロー（処理を中断）
- 設計判断: Zodスキーマを活用し、バリデーションとマッピングを一度に実行することで、コードの簡潔性を保つ

### 4. ユーザー承認の必須化

各フェーズの完了時に**必ずuserInputツールを使用**してユーザーの承認を得る:

```typescript
userInput({
  question: "**{フェーズ名}の内容は問題ありませんか？修正が必要な箇所があれば教えてください。問題なければ、次は{次のフェーズ名}に進みます。**",
  reason: "spec-{phase}-review"
})
```

### 5. 既存ファイルの確認

新しいspecを作成する前に、既存のspecファイルを確認:
- 既存のspecがある場合は更新
- 既存のspecがない場合は新規作成

---

## チェックリスト

Specを作成する際は、以下のチェックリストを使用してください:

### 要件定義フェーズ
- [ ] requirements.mdを作成
- [ ] EARS形式で受入基準を記載
- [ ] 用語集を定義
- [ ] ユーザーの承認を得た

### 基本設計フェーズ
- [ ] basic-design.mdを作成
- [ ] criteria.mdに沿って作成
- [ ] 顧客視点で記述
- [ ] 図やモックアップを活用
- [ ] ユーザーの承認を得た

### 詳細設計フェーズ
- [ ] detailed-design.mdを作成
- [ ] criteria.mdに沿って作成
- [ ] コードを記載していない（言葉で説明）
- [ ] 開発者視点で記述
- [ ] 入出力、処理ロジック、エラーハンドリングを明記
- [ ] ユーザーの承認を得た

### 設計サマリーフェーズ
- [ ] design.mdを作成
- [ ] basic-designとdetailed-designの要点をまとめた
- [ ] ユーザーの承認を得た

### レビューフェーズ
- [ ] criteria.mdに沿ってレビュー
- [ ] 基本設計書の品質チェック完了
- [ ] 詳細設計書の品質チェック完了
- [ ] コードが記載されていないことを確認

### タスクリストフェーズ
- [ ] tasks.mdを作成
- [ ] 実装タスクを具体的に分解
- [ ] 要件との紐付けを明記
- [ ] オプションタスクを明示
- [ ] ユーザーの承認を得た

---

## トラブルシューティング

### ユーザーが順序を変更したい場合

ユーザーが「basic-designをスキップしたい」などと言った場合:

1. このワークフローが**絶対厳守**であることを説明
2. 各フェーズの重要性を説明
3. 順序通りに進めることを提案

### 既存のspecを更新する場合

既存のspecを更新する場合も、同じワークフローに従う:

1. requirements.mdを更新
2. basic-design.mdを更新
3. detailed-design.mdを更新
4. design.mdを更新
5. レビュー
6. tasks.mdを更新

### criteria.mdが存在しない場合

criteria.mdが存在しない場合:

1. ユーザーに確認
2. 標準的なcriteria.mdを作成
3. ユーザーの承認を得る

---

## 参考資料

- [criteria.md](.kiro/specs/{feature_name}/criteria.md) - 設計書の品質基準
- [Feature-Sliced Design 公式ドキュメント](https://feature-sliced.github.io/documentation/ja/docs/get-started/overview)
- [EARS (Easy Approach to Requirements Syntax)](https://alistairmavin.com/ears/)

---

## まとめ

このワークフローは、高品質なspecを作成し、実装をスムーズに進めるために設計されています。

**重要なポイント**:
1. **順序を厳守する**（requirements → basic-design → detailed-design → design → レビュー → tasks）
2. **criteria.mdに沿って作成する**（basic-designとdetailed-design）
3. **詳細設計書にコードを記載しない**（言葉で説明）
4. **各フェーズでユーザーの承認を得る**

このルールを守ることで、顧客と開発者の両方が理解しやすい、高品質なspecを作成できます。
