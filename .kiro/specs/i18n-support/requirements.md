# 要件定義書

## はじめに

本ドキュメントは、週単位家計簿アプリケーションに多言語対応機能を追加するための要件を定義します。現在は日本語のみで実装されていますが、将来的に他言語への展開を視野に入れ、外部ライブラリに依存しない多言語対応の基盤を整備します。

参考記事: [App RouterでライブラリなしでI18n対応する](https://zenn.dev/progate/articles/app-router-i18n-without-library)

## 用語集

- **システム**: 週単位家計簿アプリケーション
- **ユーザー**: アプリケーションを使用するエンドユーザー
- **ロケール**: ユーザーの言語・地域設定（例: ja, en, zh-CN）
- **翻訳キー**: 翻訳文字列を識別するための一意のキー（ドット記法、例: common.save）
- **翻訳ファイル**: 言語ごとの翻訳文字列を格納するJSONファイル
- **i18n実装**: Next.js App Routerの標準機能を使用した国際化実装
- **デフォルトロケール**: システムのデフォルト言語設定（日本語: ja）
- **UI文字列**: ユーザーインターフェースに表示される文字列
- **日付フォーマット**: 日付の表示形式（例: 2025/11/19、11/19/2025）
- **数値フォーマット**: 数値の表示形式（例: 1,000、1.000）
- **通貨フォーマット**: 通貨の表示形式（例: ¥1,000、$1,000）
- **翻訳関数**: 翻訳キーを受け取り、現在のロケールに対応する文字列を返す関数

## 要件

### 要件1: 多言語対応の基盤整備

**ユーザーストーリー:** 開発者として、将来的に複数言語をサポートできるよう、外部ライブラリに依存しない多言語対応の基盤を整備したい

#### 受入基準

1. システムは、Next.js App Routerの標準機能のみを使用して多言語対応を実装しなければならない
2. システムは、ロケールごとに整理された専用のディレクトリ構造に翻訳ファイルを保存しなければならない
3. システムは、デフォルトロケールを日本語（ja）として定義しなければならない
4. システムは、翻訳キーを受け取りローカライズされた文字列を返す翻訳関数を提供しなければならない
5. システムは、URLパスベースのロケール切り替え（例: /ja/dashboard, /en/dashboard）をサポートしなければならない

### 要件2: 既存UI文字列の翻訳キー化

**ユーザーストーリー:** 開発者として、既存のハードコードされた日本語文字列を翻訳キーに置き換えたい

#### 受入基準

1. UIコンポーネントがハードコードされたテキストを含む場合、システムはそれを翻訳関数呼び出しに置き換えなければならない
2. システムは、階層的な命名規則を使用して翻訳キーを定義しなければならない（例: common.save, entry.form.amount）
3. システムは、既存のすべての日本語テキストを日本語翻訳ファイル内の翻訳として維持しなければならない
4. システムは、移行後にコンポーネントファイル内にUI文字列がハードコードされていないことを保証しなければならない
5. システムは、実行時エラーを防ぐために翻訳キーへの型安全なアクセスを提供しなければならない

### 要件3: 日付・数値・通貨のフォーマット対応

**ユーザーストーリー:** ユーザーとして、日付や金額が自分の言語設定に応じた形式で表示されることを期待する

#### 受入基準

1. システムは、現在のロケール設定に従って日付をフォーマットしなければならない
2. システムは、ロケールに適した桁区切り記号で数値をフォーマットしなければならない
3. システムは、ロケールに適した記号と配置で通貨値をフォーマットしなければならない
4. システムは、日付、数値、通貨のフォーマット用のユーティリティ関数を提供しなければならない
5. ロケールが日本語の場合、システムはYYYY/MM/DD形式で日付を表示し、通貨は¥記号を使用しなければならない

### 要件4: 翻訳ファイルの管理

**ユーザーストーリー:** 開発者として、翻訳文字列を効率的に管理・更新できる仕組みが欲しい

#### 受入基準

1. システムは、ネストされた構造を持つJSON形式で翻訳ファイルを整理しなければならない
2. システムは、現在のすべてのUI文字列を含む単一の日本語翻訳ファイルを提供しなければならない
3. システムは、すべての必要なキーが存在することを保証するために翻訳ファイルを検証しなければならない
4. システムは、新しい翻訳ファイルを作成することで新しいロケールの追加をサポートしなければならない
5. システムは、新しい翻訳を追加する方法に関する明確なドキュメントを提供しなければならない

### 要件5: 型安全性の確保

**ユーザーストーリー:** 開発者として、翻訳キーの使用時に型チェックによるエラー検出を行いたい

#### 受入基準

1. システムは、翻訳ファイルの構造に基づいたTypeScript型定義を提供しなければならない
2. システムは、IDE内で翻訳キーの自動補完を可能にする型定義を提供しなければならない
3. 開発者が無効な翻訳キーを使用した場合、システムはコンパイル時にTypeScriptエラーを表示しなければならない
4. システムは、翻訳関数の戻り値が常に文字列型であることを保証しなければならない
5. システムは、ネストされた翻訳キーへのアクセスを型安全にサポートしなければならない

### 要件6: 既存機能への影響最小化

**ユーザーストーリー:** ユーザーとして、多言語対応の実装後も既存の機能が正常に動作することを期待する

#### 受入基準

1. システムは、i18n実装後もすべての既存機能を維持しなければならない
2. システムは、デフォルトですべてのUI文字列を日本語で表示しなければならない
3. システムは、ページ読み込み時間のパフォーマンス低下を引き起こしてはならない
4. システムは、移行後にすべての既存テストが合格することを保証しなければならない
5. システムは、同じ視覚的外観とユーザーエクスペリエンスを維持しなければならない

### 要件7: 将来の拡張性

**ユーザーストーリー:** 開発者として、将来的に新しい言語を追加する際の作業を最小限にしたい

#### 受入基準

1. システムは、新しいロケールサポートを追加するための明確なプロセスを提供しなければならない
2. システムは、既存のコードを変更することなく新しい翻訳ファイルの追加を許可しなければならない
3. システムは、ブラウザ設定からのロケール検出をサポートしなければならない
4. システムは、翻訳が欠落している場合にデフォルトロケールへのフォールバックを提供しなければならない
5. 新しいロケールが追加された場合、システムはコード変更なしに新しい翻訳ファイルを自動的に使用しなければならない
