# 実装タスクリスト

## 概要

このタスクリストは、多言語対応機能の実装を段階的に進めるためのものです。各タスクは要件定義と設計書に基づいており、下位レイヤーから順に実装していきます。

**重要**: `*`が付いているサブタスクはオプション（テスト関連）です。コア機能の実装を優先する場合はスキップできます。

## タスク一覧

- [x] 1. i18n基盤の構築
- [x] 1.1 i18n設定ファイルの作成
  - `shared/lib/i18n/config.ts`を作成
  - サポートするロケール（ja, en, zh-CN）を定義
  - デフォルトロケール（ja）を定義
  - Locale型をエクスポート
  - _要件: 1.1, 1.3_

- [x] 1.2 型定義ファイルの作成
  - `shared/lib/i18n/types.ts`を作成
  - Locale型を定義
  - Dictionary型を定義（翻訳オブジェクトの型）
  - _要件: 5.1, 5.2_

- [x] 1.3 翻訳取得関数の実装
  - `shared/lib/i18n/get-dictionary.ts`を作成
  - `getDictionary(locale)`関数を実装
  - 動的インポートで翻訳ファイルを読み込み
  - サポートされていないロケールの場合、デフォルトロケールにフォールバック
  - エラーハンドリングを実装
  - _要件: 1.4, 7.4_

- [x] 1.4 フォーマッター関数の実装
  - `shared/lib/i18n/formatters.ts`を作成
  - `formatDate(date, locale)`関数を実装（Intl.DateTimeFormat使用）
  - `formatNumber(value, locale)`関数を実装（Intl.NumberFormat使用）
  - `formatCurrency(amount, locale, currency)`関数を実装
  - エラーハンドリングを実装（無効な入力時のデフォルト値）
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 1.5 i18nモジュールのエクスポート
  - `shared/lib/i18n/index.ts`を作成
  - すべてのi18n関連の関数と型をエクスポート
  - _要件: 1.1, 1.4_

- [ ]* 1.6 i18n基盤の単体テスト
  - `shared/lib/i18n/config.test.ts`を作成
  - `shared/lib/i18n/get-dictionary.test.ts`を作成
  - `shared/lib/i18n/formatters.test.ts`を作成
  - デフォルトロケール、翻訳取得、フォーマット機能をテスト
  - _要件: 1.1, 1.4, 3.1, 3.2, 3.3_

- [x] 2. 翻訳ファイルの作成
- [x] 2.1 翻訳ファイルディレクトリの作成
  - `dictionaries/`ディレクトリを作成
  - _要件: 1.2, 4.2_

- [x] 2.2 日本語翻訳ファイルの作成
  - `dictionaries/ja.json`を作成
  - 既存のすべてのUI文字列を抽出して翻訳キーとして定義
  - 階層構造で整理（common, entry, category, account, dashboard, error, validation）
  - 命名規則に従う（小文字、キャメルケース、ドット区切り）
  - _要件: 1.2, 2.3, 4.1, 4.2, 4.3_

- [x] 2.3 英語翻訳ファイルのスケルトン作成
  - `dictionaries/en.json`を作成（将来の拡張用）
  - ja.jsonと同じ構造で、値は英語プレースホルダー
  - _要件: 4.4, 7.1, 7.2_

- [ ]* 2.4 翻訳ファイルの検証
  - 翻訳ファイルのJSON形式が正しいことを確認
  - すべての必須キーが存在することを確認
  - _要件: 4.3_

- [ ] 3. ルーティングの変更
- [x] 3.1 ルートページのリダイレクト実装
  - `app/page.tsx`を修正
  - ルートパス（/）を`/ja`にリダイレクト
  - Next.jsの`redirect`関数を使用
  - _要件: 1.5, 6.2_

- [x] 3.2 ロケール対応レイアウトの作成
  - `app/[locale]/layout.tsx`を作成
  - paramsからロケールを取得
  - ロケールを検証（サポートされているか確認）
  - `lang`属性にロケールを設定
  - 子コンポーネントをレンダリング
  - _要件: 1.5, 6.2_

- [x] 3.3 ダッシュボードページの移行
  - `app/[locale]/page.tsx`を作成
  - paramsからロケールを取得
  - `getDictionary(locale)`で翻訳を取得
  - 認証チェック（`auth()`）
  - カテゴリとアカウントのデータを取得
  - DashboardPageコンポーネントに翻訳とデータを渡す
  - 既存の`app/page.tsx`の処理を移行
  - _要件: 1.4, 1.5, 6.1, 6.2_

- [ ]* 3.4 ルーティングの統合テスト
  - `/ja/dashboard`にアクセスできることを確認
  - `/dashboard`が`/ja/dashboard`にリダイレクトされることを確認
  - 無効なロケールでデフォルトロケールが使用されることを確認
  - _要件: 1.5, 6.2_

- [ ] 4. shared層コンポーネントの移行
- [ ] 4.1 Buttonコンポーネントの移行
  - `shared/ui/Button.tsx`を修正
  - propsに`dict`を追加（オプション）
  - ボタンラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ] 4.2 Dialogコンポーネントの移行
  - `shared/ui/Dialog.tsx`を修正
  - propsに`dict`を追加
  - ダイアログタイトル、ボタンラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ] 4.3 EmptyStateコンポーネントの移行
  - `shared/ui/EmptyState.tsx`を修正
  - propsに`dict`を追加
  - 空状態メッセージを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ] 4.4 Badgeコンポーネントの移行
  - `shared/ui/Badge.tsx`を修正
  - propsに`dict`を追加（オプション）
  - バッジラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ]* 4.5 shared層コンポーネントのテスト
  - 各コンポーネントが翻訳オブジェクトを受け取って正しく表示されることを確認
  - _要件: 2.1, 2.2, 6.4_

- [ ] 5. entities層コンポーネントの移行
- [ ] 5.1 EntryItemコンポーネントの移行
  - `entities/entry/ui/EntryItem.tsx`を修正
  - propsに`dict`と`locale`を追加
  - 取引タイプ（収入/支出）のラベルを翻訳キー経由で取得
  - 日付と金額のフォーマットに`formatDate`と`formatCurrency`を使用
  - _要件: 2.1, 2.2, 2.4, 3.1, 3.3, 3.5_

- [ ] 5.2 CategoryItemコンポーネントの移行
  - `entities/category/ui/CategoryItem.tsx`を修正（存在する場合）
  - propsに`dict`を追加
  - カテゴリ関連のラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ] 5.3 AccountItemコンポーネントの移行
  - `entities/account/ui/AccountItem.tsx`を修正（存在する場合）
  - propsに`dict`を追加
  - アカウント関連のラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ]* 5.4 entities層コンポーネントのテスト
  - 各コンポーネントが翻訳とフォーマットを正しく使用することを確認
  - _要件: 2.1, 2.2, 3.1, 3.3, 6.4_

- [ ] 6. features層コンポーネントの移行
- [ ] 6.1 AddEntryFormコンポーネントの移行
  - `features/addEntry/ui/AddEntryForm.tsx`を修正
  - propsに`dict`を追加
  - フォームラベル（金額、カテゴリ、日付、メモ）を翻訳キー経由で取得
  - ボタンラベル（保存、キャンセル）を翻訳キー経由で取得
  - バリデーションエラーメッセージを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ] 6.2 AddEntryButtonコンポーネントの移行
  - `features/addEntry/ui/AddEntryButton.tsx`を修正（存在する場合）
  - propsに`dict`を追加
  - ボタンラベルを翻訳キー経由で取得
  - _要件: 2.1, 2.2, 2.4_

- [ ]* 6.3 features層コンポーネントのテスト
  - フォームが翻訳を正しく使用することを確認
  - バリデーションエラーメッセージが翻訳されることを確認
  - _要件: 2.1, 2.2, 6.4_

- [ ] 7. pages層コンポーネントの移行
- [ ] 7.1 DashboardPageコンポーネントの移行
  - `pages/dashboard/index.tsx`を修正
  - propsに`dict`と`locale`を追加
  - ダッシュボードのタイトル、サマリーラベルを翻訳キー経由で取得
  - 子コンポーネントに`dict`と`locale`を渡す
  - _要件: 2.1, 2.2, 2.4, 6.1_

- [ ] 7.2 EntryPageコンポーネントの移行
  - `pages/entry/index.tsx`を修正（存在する場合）
  - propsに`dict`と`locale`を追加
  - 取引一覧のタイトル、ラベルを翻訳キー経由で取得
  - 子コンポーネントに`dict`と`locale`を渡す
  - _要件: 2.1, 2.2, 2.4, 6.1_

- [ ] 7.3 CategoryPageコンポーネントの移行
  - `pages/category/index.tsx`を修正（存在する場合）
  - propsに`dict`と`locale`を追加
  - カテゴリ管理のタイトル、ラベルを翻訳キー経由で取得
  - 子コンポーネントに`dict`と`locale`を渡す
  - _要件: 2.1, 2.2, 2.4, 6.1_

- [ ]* 7.4 pages層コンポーネントのテスト
  - 各ページが翻訳を正しく使用することを確認
  - 子コンポーネントに翻訳が正しく渡されることを確認
  - _要件: 2.1, 2.2, 6.4_

- [ ] 8. エラーメッセージの国際化
- [ ] 8.1 Server Actionsのエラーメッセージ修正
  - `entities/category/api/categoryApi.ts`を修正
  - エラーメッセージを翻訳キーに変更（例: "error.categoryNotFound"）
  - _要件: 2.1, 2.2_

- [ ] 8.2 エラーハンドリングの更新
  - コンポーネント側でエラーキーを翻訳
  - `dict.error[errorKey]`で翻訳を取得
  - 翻訳が見つからない場合は`dict.error.unknown`を使用
  - _要件: 2.1, 2.2, 7.4_

- [ ]* 8.3 エラーメッセージのテスト
  - エラーが翻訳キーで返されることを確認
  - コンポーネント側で翻訳されることを確認
  - _要件: 2.1, 2.2, 6.4_

- [ ] 9. 既存テストの更新
- [ ]* 9.1 コンポーネントテストの更新
  - 翻訳オブジェクトをモックとして渡す
  - テストが正常に動作することを確認
  - _要件: 6.4_

- [ ]* 9.2 統合テストの更新
  - ロケールパラメータを含むURLでテスト
  - 翻訳が正しく表示されることを確認
  - _要件: 6.4_

- [ ] 10. ドキュメントの作成
- [ ]* 10.1 開発者向けドキュメントの作成
  - `docs/i18n.md`を作成
  - i18nの使い方、翻訳キーの追加方法、新しいロケールの追加方法を記載
  - フォーマッター関数の使い方を記載
  - トラブルシューティングを記載
  - _要件: 4.5, 7.1_

- [ ]* 10.2 翻訳者向けドキュメントの作成
  - `docs/translation-guide.md`を作成
  - 翻訳ファイルの構造、翻訳のガイドライン、プレースホルダーの使い方を記載
  - _要件: 4.5_

- [ ] 11. 最終検証
- [ ] 11.1 手動テスト
  - すべてのページで日本語が正しく表示されることを確認
  - 日付と通貨が正しくフォーマットされることを確認
  - エラーメッセージが翻訳されることを確認
  - _要件: 6.1, 6.2, 6.5_

- [ ] 11.2 パフォーマンステスト
  - Lighthouseスコアを測定
  - ページ読み込み時間が既存と同等であることを確認
  - バンドルサイズの増加が5KB以内であることを確認
  - _要件: 6.3_

- [ ] 11.3 アクセシビリティチェック
  - `lang`属性が正しく設定されていることを確認
  - スクリーンリーダーで動作確認
  - _要件: 6.5_

- [ ] 11.4 ブラウザ互換性テスト
  - Chrome、Firefox、Safari、Edgeで動作確認
  - _要件: 6.5_

## 実装の優先順位

1. **フェーズ1: 基盤構築**（タスク1-2）
   - i18n基盤と翻訳ファイルの作成
   - 最も重要な基礎部分

2. **フェーズ2: ルーティング変更**（タスク3）
   - ロケール対応ルーティングの実装
   - アプリケーション全体に影響

3. **フェーズ3: コンポーネント移行**（タスク4-7）
   - 下位レイヤーから順に移行
   - shared → entities → features → pages

4. **フェーズ4: エラーメッセージとテスト**（タスク8-9）
   - エラーメッセージの国際化
   - 既存テストの更新

5. **フェーズ5: ドキュメントと検証**（タスク10-11）
   - ドキュメント作成
   - 最終検証

## 注意事項

- オプションタスク（`*`付き）は、コア機能の実装を優先する場合はスキップ可能です
- 各タスクは独立しているため、並行して作業することも可能です
- ただし、フェーズ1（基盤構築）は他のすべてのタスクの前提条件です
- 実装中に問題が発生した場合は、設計書を参照してください
