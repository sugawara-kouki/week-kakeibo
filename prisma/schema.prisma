// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’mysqlã«è¨­å®š
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// -----------------------------------------
// ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©
// -----------------------------------------

model Transaction {
  id          String   @id @default(uuid())
  // ğŸ”‘ Clerkã¨ã®é€£æºãƒã‚¤ãƒ³ãƒˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å¿…ãšå«ã‚ã‚‹
  userId      String   @db.VarChar(255) 
  type        String // 'income' or 'expense'
  amount      Float
  date        DateTime @default(now())
  description String?
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  category    Category @relation(fields: [categoryId], references: [id])
  categoryId  String
  
  account     Account  @relation(fields: [accountId], references: [id])
  accountId   String

  @@index([userId]) // userIdã§æ¤œç´¢ãŒé€Ÿããªã‚‹ã‚ˆã†ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¼µã‚‹
}

model Category {
  id          String        @id @default(uuid())
  // ã‚«ãƒ†ã‚´ãƒªå: ä¾‹: 'é£Ÿè²»', 'çµ¦ä¸', 'äº¤é€šè²»'
  name        String        @unique 
  // ã‚«ãƒ†ã‚´ãƒªã®è‰²ï¼ˆUIè¡¨ç¤ºç”¨ã€‚å¿…é ˆã§ã¯ãªã„ãŒä¾¿åˆ©ï¼‰
  color       String        @default("#cccccc") 

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ğŸ”‘ ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªã‹è­˜åˆ¥ã™ã‚‹ãŸã‚
  userId      String        @db.VarChar(255) 

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: å¤šæ•°ã® Transaction ãŒã“ã® Category ã«ç´ã¥ã
  transactions Transaction[] 

  @@index([userId]) // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã®æ¤œç´¢ã‚’é«˜é€ŸåŒ–
}

model Account {
  id          String        @id @default(uuid())
  // å£åº§å: ä¾‹: 'ãƒ¡ã‚¤ãƒ³éŠ€è¡Œ', 'ç¾é‡‘', 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰A'
  name        String
  // åˆæœŸæ®‹é«˜ (ã‚ã‚‹ã„ã¯ç¾åœ¨ã®æ®‹é«˜ã€‚é›†è¨ˆæ™‚ã«ä½¿ç”¨)
  initialBalance Float       @default(0) 

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ğŸ”‘ ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å£åº§ã‹è­˜åˆ¥ã™ã‚‹ãŸã‚
  userId      String        @db.VarChar(255)

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: å¤šæ•°ã® Transaction ãŒã“ã® Account ã«ç´ã¥ã
  transactions Transaction[]

  @@unique([userId, name]) // åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åŒã˜åå‰ã®å£åº§ã‚’æŒãŸãªã„
  @@index([userId]) // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã®æ¤œç´¢ã‚’é«˜é€ŸåŒ–
}
